<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fraction Practice</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Fredoka', sans-serif;
    }
    .game-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
    }
    .game-card {
      transition: all 0.3s ease;
    }
    .btn-green {
      background-color: #22c55e;
      transition: all 0.2s ease;
    }
    .btn-green:hover {
      background-color: #16a34a;
    }
    .game-frame-fullscreen {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999 !important;
      border: none !important;
      border-radius: 0 !important;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-white text-gray-800">
  <div id="app" class="h-full overflow-auto"><!-- Navigation -->
   <nav class="bg-white border-b-4 border-green-500 px-6 py-4 sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
     <h1 id="site-title" class="text-2xl font-bold text-green-600 cursor-pointer" onclick="showPage('home')">Fraction Practice</h1>
     <div class="flex gap-4"><button onclick="showPage('home')" class="text-gray-700 hover:text-green-600 font-medium transition-colors">Home</button> <button onclick="showPage('credits')" class="text-gray-700 hover:text-green-600 font-medium transition-colors">Credits</button> <button id="auth-btn" onclick="showPage('auth')" class="btn-green text-white px-4 py-2 rounded-lg font-medium">Sign Up / Log In</button>
     </div>
    </div>
   </nav><!-- Home Page -->
   <div id="page-home" class="page max-w-6xl mx-auto px-6 py-8">
    <div class="text-center mb-10">
     <h2 class="text-4xl font-bold text-green-600 mb-3">Welcome to Fraction Practice!</h2>
     <p id="submotto" class="text-lg text-gray-600">Exercise your brain in a fun way and... stuff</p>
    </div><!-- Games Grid -->
    <div id="games-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"><!-- Game Card 1 -->
     <div class="game-card bg-white border-2 border-green-400 rounded-xl overflow-hidden cursor-pointer shadow-md" onclick="loadGame('Fraction Frenzy', 'https://raw.githubusercontent.com/example/fraction-frenzy/main/index.html')">
      <div class="aspect-video bg-green-50 flex items-center justify-center"><img src="" alt="Fraction Frenzy" class="w-full h-full object-cover">
      </div>
      <div class="p-4 bg-white">
       <h3 class="text-xl font-semibold text-gray-800 text-center">Fraction Frenzy</h3>
      </div>
     </div>
    </div>
   </div><!-- Auth Page -->
   <div id="page-auth" class="page hidden max-w-md mx-auto px-6 py-8">
    <div class="bg-white border-2 border-green-400 rounded-xl p-8 shadow-lg">
     <h2 id="auth-title" class="text-3xl font-bold text-green-600 mb-6 text-center">Sign Up</h2>
     <div id="auth-message" class="hidden mb-4 p-3 rounded-lg text-center font-medium"></div>
     <div class="space-y-4">
      <div><label for="username" class="block text-gray-700 font-medium mb-1">Username</label> <input type="text" id="username" class="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500" placeholder="Enter username">
      </div>
      <div><label for="password" class="block text-gray-700 font-medium mb-1">Password</label> <input type="password" id="password" class="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500" placeholder="Enter password">
      </div><button id="auth-submit" onclick="handleAuth()" class="w-full btn-green text-white py-3 rounded-lg font-semibold text-lg">Sign Up</button>
     </div>
     <p class="text-center mt-6 text-gray-600"><span id="auth-switch-text">Already have an account?</span> <button id="auth-switch-btn" onclick="toggleAuthMode()" class="text-green-600 font-medium hover:underline ml-1">Log In</button></p>
    </div>
   </div><!-- Credits Page -->
   <div id="page-credits" class="page hidden max-w-2xl mx-auto px-6 py-8">
    <div class="bg-white border-2 border-green-400 rounded-xl p-8 shadow-lg">
     <h2 class="text-3xl font-bold text-green-600 mb-8 text-center">Credits</h2>
     <div class="space-y-6 text-center">
      <div>
       <p class="text-xl font-semibold text-gray-800">Owner</p>
       <p class="text-lg text-gray-600">John Smith</p>
      </div>
      <div>
       <p class="text-xl font-semibold text-gray-800">Co-Owner</p>
       <p class="text-lg text-gray-600">Jane Doe</p>
      </div>
     </div>
    </div>
   </div><!-- Game Player Overlay -->
   <div id="game-overlay" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50">
    <div id="game-container" class="h-full flex flex-col"><!-- Game Controls -->
     <div id="game-controls" class="bg-white px-4 py-3 flex items-center justify-between border-b-2 border-green-500">
      <h3 id="game-title" class="text-xl font-bold text-green-600">Game Title</h3>
      <div class="flex gap-3"><button onclick="toggleFullscreen()" class="bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
        </svg> Fullscreen </button> <button onclick="openInNewTab()" class="bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg> New Tab </button> <button onclick="closeGame()" class="bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg> Close </button>
      </div>
     </div><!-- Game Frame -->
     <div class="flex-1 bg-gray-900 relative">
      <div id="game-loading" class="absolute inset-0 flex items-center justify-center bg-gray-900">
       <div class="text-center">
        <div class="w-16 h-16 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-white text-lg">Loading game...</p>
       </div>
      </div><iframe id="game-frame" class="w-full h-full border-none" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
     </div>
    </div>
   </div>
  </div>
  <script>
    // State
    let currentUser = null;
    let isSignUpMode = true;
    let currentGameCode = '';
    let isFullscreen = false;

    // Config
    const defaultConfig = {
      site_title: 'Fraction Practice',
      submotto: 'Exercise your brain in a fun way and... stuff'
    };

    // Initialize
    function init() {
      checkLoggedInUser();
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            document.getElementById('site-title').textContent = config.site_title || defaultConfig.site_title;
            document.getElementById('submotto').textContent = config.submotto || defaultConfig.submotto;
            document.title = config.site_title || defaultConfig.site_title;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['site_title', config.site_title || defaultConfig.site_title],
            ['submotto', config.submotto || defaultConfig.submotto]
          ])
        });
      }
    }

    // Page Navigation
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(`page-${pageName}`).classList.remove('hidden');
    }

    // Auth Functions
    function checkLoggedInUser() {
      const savedUser = localStorage.getItem('fp_current_user');
      if (savedUser) {
        currentUser = savedUser;
        updateAuthButton();
      }
    }

    function updateAuthButton() {
      const authBtn = document.getElementById('auth-btn');
      if (currentUser) {
        authBtn.textContent = `Hi, ${currentUser}!`;
        authBtn.onclick = logout;
      } else {
        authBtn.textContent = 'Sign Up / Log In';
        authBtn.onclick = () => showPage('auth');
      }
    }

    function toggleAuthMode() {
      isSignUpMode = !isSignUpMode;
      document.getElementById('auth-title').textContent = isSignUpMode ? 'Sign Up' : 'Log In';
      document.getElementById('auth-submit').textContent = isSignUpMode ? 'Sign Up' : 'Log In';
      document.getElementById('auth-switch-text').textContent = isSignUpMode ? 'Already have an account?' : "Don't have an account?";
      document.getElementById('auth-switch-btn').textContent = isSignUpMode ? 'Log In' : 'Sign Up';
      hideAuthMessage();
    }

    function showAuthMessage(message, isError) {
      const msgEl = document.getElementById('auth-message');
      msgEl.textContent = message;
      msgEl.className = `mb-4 p-3 rounded-lg text-center font-medium ${isError ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
      msgEl.classList.remove('hidden');
    }

    function hideAuthMessage() {
      document.getElementById('auth-message').classList.add('hidden');
    }

    function handleAuth() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (!username || !password) {
        showAuthMessage('Please fill in all fields', true);
        return;
      }

      const users = JSON.parse(localStorage.getItem('fp_users') || '{}');

      if (isSignUpMode) {
        if (users[username]) {
          showAuthMessage('Username already exists', true);
          return;
        }
        users[username] = password;
        localStorage.setItem('fp_users', JSON.stringify(users));
        currentUser = username;
        localStorage.setItem('fp_current_user', username);
        showAuthMessage('Account created successfully!', false);
      } else {
        if (!users[username] || users[username] !== password) {
          showAuthMessage('Invalid username or password', true);
          return;
        }
        currentUser = username;
        localStorage.setItem('fp_current_user', username);
        showAuthMessage('Logged in successfully!', false);
      }

      updateAuthButton();
      setTimeout(() => showPage('home'), 1000);
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem('fp_current_user');
      updateAuthButton();
      showAuthMessage('Logged out successfully!', false);
      showPage('auth');
    }

    // Game Functions
    async function loadGame(gameName, gameUrl) {
      document.getElementById('game-overlay').classList.remove('hidden');
      document.getElementById('game-title').textContent = gameName;
      document.getElementById('game-loading').classList.remove('hidden');
      document.getElementById('game-frame').srcdoc = '';

      try {
        const response = await fetch(gameUrl);
        if (!response.ok) throw new Error('Failed to fetch game');
        currentGameCode = await response.text();
        document.getElementById('game-frame').srcdoc = currentGameCode;
        document.getElementById('game-loading').classList.add('hidden');
      } catch (error) {
        document.getElementById('game-loading').innerHTML = `
          <div class="text-center">
            <p class="text-red-400 text-lg mb-2">Failed to load game</p>
            <p class="text-gray-400">Please check the URL and try again</p>
          </div>
        `;
      }
    }

    function closeGame() {
      if (isFullscreen) {
        toggleFullscreen();
      }
      document.getElementById('game-overlay').classList.add('hidden');
      document.getElementById('game-frame').srcdoc = '';
      currentGameCode = '';
    }

    function toggleFullscreen() {
      const gameFrame = document.getElementById('game-frame');
      const gameControls = document.getElementById('game-controls');
      
      if (!isFullscreen) {
        gameFrame.classList.add('game-frame-fullscreen');
        gameControls.classList.add('hidden');
        isFullscreen = true;
        
        document.addEventListener('keydown', exitFullscreenOnEsc);
      } else {
        gameFrame.classList.remove('game-frame-fullscreen');
        gameControls.classList.remove('hidden');
        isFullscreen = false;
        
        document.removeEventListener('keydown', exitFullscreenOnEsc);
      }
    }

    function exitFullscreenOnEsc(e) {
      if (e.key === 'Escape' && isFullscreen) {
        toggleFullscreen();
      }
    }

    function openInNewTab() {
      if (!currentGameCode) return;
      
      const newWindow = window.open('about:blank', '_blank');
      if (newWindow) {
        newWindow.document.write(currentGameCode);
        newWindow.document.close();
      }
    }

    // Initialize on load
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9befa786628bb859',t:'MTc2ODU4NzkxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
